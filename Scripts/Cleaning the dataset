--AS we concern with the habitual use of bike and the types of bike use that make up the majorirty of rides, outliners such rent longer then 1 day should be omitted
WITH A1 AS (
SELECT
  ride_id, started_at, ended_at, member_casual
FROM `Bike_data.202102_tripdata`
WHERE
  (EXTRACT(DAY FROM started_at) = EXTRACT(DAY FROM ended_at))
  AND (EXTRACT(TIME FROM ended_at) > EXTRACT(TIME FROM started_at))

UNION ALL

SELECT
  ride_id, started_at, ended_at, member_casual
FROM `Bike_data.202103_tripdata`
WHERE
  (EXTRACT(DAY FROM started_at) = EXTRACT(DAY FROM ended_at))
  AND (EXTRACT(TIME FROM ended_at) > EXTRACT(TIME FROM started_at))

UNION ALL

SELECT
  ride_id, started_at, ended_at, member_casual
FROM `Bike_data.202104_tripdata`
WHERE
  (EXTRACT(DAY FROM started_at) = EXTRACT(DAY FROM ended_at))
  AND (EXTRACT(TIME FROM ended_at) > EXTRACT(TIME FROM started_at))

UNION ALL

SELECT
  ride_id, started_at, ended_at, member_casual
FROM `Bike_data.202105_tripdata`
WHERE
  (EXTRACT(DAY FROM started_at) = EXTRACT(DAY FROM ended_at))
  AND (EXTRACT(TIME FROM ended_at) > EXTRACT(TIME FROM started_at))
)
SELECT 
  ride_id,
  started_at,
  ended_at,
  (EXTRACT(HOUR FROM ended_at) - EXTRACT(HOUR FROM started_at))*60 + (EXTRACT(MINUTE FROM ended_at) - EXTRACT(MINUTE FROM started_at)) AS Ride_length,
  Member_casual
FROM A1
